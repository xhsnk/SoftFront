<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>音乐播放</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-table.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-table-zh-CN.min.js"></script>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        body {
            background-color: #86cfda;
        }
        /***********头部的导航栏*******/
        .head{
            position: relative;
            width: 100%;
            height: 100px;
            background-color: #1d2124;
            color: #f2f2f2;
        }
        .lable{
            width: 200px;
            height: 100%;
            margin-left: 150px;
            font-size: 35px;
            line-height: 100px;
            display: inline-block;
        }
        .headTab{
            display: inline-block;
            width: 800px;
            height: 100%;
            list-style: none;
            line-height: 100px;
            font-size: 20px;
            color: #f2f2f2;
        }
        .headTab li{
            display: inline-block;
            width: 100px;
            text-align: center;
        }
        .head_search{
            display: inline-block;
            position: absolute;
            top: 25px;
            right: 500px;
            background-color: white;
            width: 300px;
            height: 50px;
            border-radius: 30px;
        }
        .head_search img{
            margin-left: 8px;
        }
        #search{
            display: inline-block;
            width: 70%;
            height: 100%;
            border: 0;
            outline:none;
            color: black;
        }
        .main{
            position: relative;
            width: 100%;
        }
        /************旋转唱片*********/
        .circle-song{
            position: absolute;
            top: 50px;
            left: 180px;
            width: 650px;
            height: 650px;
            background-color: #7abaff;
            border-radius: 50%;
            text-align: center;
            line-height: 650px;
        }
        .circle-song img{
            width: 80%;
            height: 80%;
            border-radius: 50%;
        }
        #last, #next{
            position: absolute;
            top: 300px;
            left: 50px;
            width: 50px;
            height: 150px;
        }
        #next{
            left: 850px;
        }
        #last:hover,#next:hover{
            top: 298px;
        }
        #last:active,#next:active{
            top: 300px;
        }

        /************歌曲信息*********/
        .info{
            position: absolute;
            top: 150px;
            right: 150px;
            width: 800px;
            height: 400px;
            background-color: #0f6674;
        }
        .btn{
            font-size: 22px;
            margin-right: 30px;
        }
        .btn img{
            margin-right: 10px;
        }
        .list-group{
            margin-top: 40px;
            width: 80%;
            height: 70%;
            overflow-y: scroll;
        }
        /************歌曲播放*********/
        #music-player{
            position: fixed;
            bottom: 0px;
            z-index: 9999;
            width: 100%;
            height: 100px;
            /*background-color: #17a2b8;*/
        }
        #music-player audio{
            width: 100%;
            /*height: 100px;*/
        }
        #myAudio{
            height: 100px;
        }
        /************评论*********/
        .comment{
            position: absolute;    /*相对于整个文档定位*/
            top: 800px;
            left: 0;
            right: 0;
            padding: 40px 20px;
            margin: auto;
            width: 70%;
            height: 700px;
            background-color: #abdde5;
        }
        .comment_line{
            width: 90%;
            height: 50px;
            font-size: 30px;
            font-family:Arial,Helvetica,sans-serif;
            line-height: 50px;
            padding-left: 15px;
            border-bottom: 3px solid green;
        }
        .myCmt{
            width: 90%;
            height: 300px;
            margin-top: 30px;
            background-color: #FFFFFF;
            position: relative;
        }
        .myCmt .userName{
            position: absolute;
            top: 10px;
            left: 10px;
            height: 50px;
            width: 180px;
            color: #34ce57;
            text-align: center;
            line-height: 50px;
            font-size:26px;
        }
        .form-group{
            position: absolute;
            top: 10px;
            left: 200px;
            width: 80%;
            height: 50%;
        }
        .form-control{
            width: 100%;
            height: 100%;
        }
        .lookCmt{
            width: 90%;
            background-color: #9fcdff;
        }
        #comts>tbody>tr>td{ border-left: 0;border-right: 0;}
        #comts>thead>tr>th{ border: 0 }
        .btn{
            position: absolute;
            right: 100px;
            bottom: 50px;
        }

    </style>
    <script>
        $(function(){
            //获取上个页面参数
            let url = window.location.href;
            let songId = url.split("="); //截取 url中的“=”,获得“=”后面的参数

            //根据歌曲Id获取歌曲信息
            function songInfo(songId){
                $.ajax({
                    url: `http://localhost:8088/songs/querySongById?id=${songId}`,
                    // data: {id: songId},
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                        console.log(data)
                    }
                })
            }
            songInfo(songId[1])

            //监听音乐播放状态
            function status(){
                let rotate;  //唱片旋转定时器
                let audioStatus = "paused";
                let audio = document.getElementById("myAudio");
                audio.addEventListener("playing", function(){
                    audioStatus = "playing";
                    rotate = setInterval(circle_rotate, 20)
                });
                audio.addEventListener("pause", function(){
                    audioStatus = "paused";
                    clearInterval(rotate)
                });
            }
            status();

            //唱片旋转函数
            let degree = 0;
            function circle_rotate() {
                degree = degree+ 40 * Math.PI / 180;
                $(".circle-song").css("transform", "rotate("+degree+"deg)");
            }

            //切换歌曲
            function chang_music(songName) {
                songName = "music/缺氧.MP3"
                $("#music-player").html("")
                  let aud = $(' <audio  id="myAudio" controls>\n' +
                          '  <source src="'+songName+'">\n' +
                          ' </audio>')
                  //放到容器里区
                  $("#music-player").html(aud)
                  //获取当前audio
                  var audio = $("#myAudio")[0];
                  //局部load()一下
                  aud.load();
                  status();
                  audio.play();
            }
            //测试切换歌曲功能
            $("#next").click(chang_music)

            //初始化表格
            function tableInit(comments){
                $('#comts').bootstrapTable({
                    columns: [{
                        field: 'author',
                        title: '',
                        width: '220px',
                        halign: 'center',
                        align: 'center',
                        color: '#34ce57'
                    }, {
                        field: 'content',
                        title: '',
                        halign: 'center'
                    }],
                    data: comments,
                    onClickRow:function(row, $element,field){
                        var i = $element.data('index');//可通过此参数获取当前行号
                        console.log(row)
                    }
                });
                $('#comts').bootstrapTable('hideLoading')
            };

            // 初始化歌曲表格
            // function init() {
            //     $('#songList').bootstrapTable({
            //         columns: [{
            //             field: 'name',
            //             title: 'vwad'
            //         }, {
            //             field: 'songer',
            //             title: 'Item Name'
            //         }],
            //         data: songs,
            //         showLoading: false,
            //         onClickRow:function(row, $element,field){
            //             var i = $element.data('index');//可通过此参数获取当前行号
            //             console.log(row)
            //         }
            //     });
            //     $('#songs').bootstrapTable('hideLoading')
            // }
            // init();

            // 获取歌曲列表
            function  getSongs() {
                $.ajax({
                    url: 'http://localhost:8088/comment/selectAllCommentsByName?',
                    data: param,
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                        // tableInit()
                        // console.log(data)
                        tableInit(data)
                    }
                })
            }

            //跳转到歌曲页面
            function jumpSongs(){
                var aa = [];
                var as = {};
                as.s = 'ssss';
                aa.push(as);
                var aaS = JSON.stringify(aa);
                var twoUrl = encodeURI("two.html?ownText=" + JSON.stringify(aaS)); //使用encodeURI编码
                location.href = twoUrl;
            }

            // 查询评论
            let param = {aim: "十年"}
            function getData(param){
                $.ajax({
                    url: 'http://localhost:8088/comment/selectAllCommentsByName?',
                    data: param,
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                        // tableInit()
                        // console.log(data)
                        tableInit(data)
                    }
                });
            }
            getData(param)

            //发布评论
            function postComt() {
                // let param = {
                //     author: "默认用户",
                //     commentAim: "string",
                //     content: "string",
                //     id: 0,
                //     praisePoints: 0,
                //     publicationTime: "string",
                //     replayId: "string"
                // };
                let param = {
                    "author": "string",
                    "commentAim": "string",
                    "content": "string",
                    "id": 0,
                    "praisePoints": 0,
                    "publicationTime": "string",
                    "replayId": "string"
                }
                // param.author = auther;
                param.content = $("#comment").val();
                console.log(param)
                $.ajax({
                    url: 'http://localhost:8088/comment/addComments',
                    // data: JSON.stringify(param),
                    data: JSON.stringify(param),
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    success: function (data) {
                       console.log(data)
                    }
                })
            }
            $("#postComt").click(() => {
                postComt()
            })






        })
    </script>
</head>
<!--<body class='particle-network-animation'>-->
<body>
<!---------------------------------------上面的导航栏部分------------------------------->
    <div class="head">
    <div class="lable">网易云音乐</div>
    <ul class="headTab">
        <li>发现音乐</li>
        <li>我的音乐</li>
        <li>朋友</li>
        <li>商城</li>
        <li>音乐人</li>
        <li>下载客户端</li>
    </ul>
    <div class="head_search">
        <img src="img/search.png" alt="404">
        <input type="text" id="search" placeholder="歌名/歌手/专辑"/>
    </div>
</div>
<!---------------------------------------播放音乐部分------------------------------->
<div class="main">
    <!---------------------------------------旋转唱片------------------------------->
    <div  class="circle-song">
        <img src="img/专辑.jpg" alt="404"/>
    </div>
    <div id="last"><img src="img/last.png"></div>
    <div id="next"><img src="img/next.png"></div>
    <div class="info">
        <div class="btnList">
            <button type="button" class="btn btn-success"><img src="img/点赞2.png">    点赞</button>
            <button type="button" class="btn btn-success"><img src="img/收藏.png">     收藏</button>
            <button type="button" class="btn btn-success"><img src="img/下载.png">     下载</button>
            <button type="button" class="btn btn-success"><img src="img/分享.png">     分享</button>
        </div>
        <div class="list-group">
          <table class="table table-hover" id="songList"></table>
      </div>
    </div>
    <div id="music-player">
        <audio id="myAudio" controls>
            <source src="music/菊次郎的夏天.mp3" type="audio/mpeg">
        </audio>
    </div>
    <!---------------------------------------旋转唱片------------------------------->
    <div class="comment">
        <div class="comment_line">评   论</div>
<!-------------------添加评论----------->
        <div class="myCmt">
            <div class="userName">添加评论：</div>
            <div class="form-group" id="form">
                <input type="text" class="form-control" id="comment"
                       placeholder="评论">
            </div>
<!--            <div class="btn">-->
            <button type="button"  id="postComt" class="btn btn-success" >发  布</button>
<!--            </div>-->
        </div>
<!-------------------查看评论----------->
        <div class="lookCmt">
            <table class="table table-hover" id="comts"></table>
        </div>



    </div>
</div>

</body>
</html>
